function rewatajaxParseBodyData(a,b){var c=[];return $(a).each(function(a,d){var e=[];for(var f in d)b[f]&&void 0==d[f]||(e[f]=d[f]);var g=[];for(var h in b){var i=b[h].type,j=b[h].transform,k=e[h],l="";switch(i){case"date":l=new Date(k.date).toLocaleString();break;default:if(l=j,l&&l.match("!_self")){if(!(void 0!=k&&k||b[h].virtual)){l="";break}var m="!_self";l=l.replace(new RegExp(m,"g"),k)}if(l&&""!=l)for(var n in e)m="!"+n,l=l.replace(new RegExp(m,"g"),e[n]);else l=d[h]}g.push({key:h,content:l})}c.push(g)}),c}!function(a){a.fn.extend({rewatajax:function(b,c,d){var e={table_class:"",sort_by:"",sort_mode:"",current_page:1,per_page:30,pager_max_buttons:5,ajax_connector:"/ajax.php",search:!0,searchWord:"",search_timeout:300,language:{filter:"Filter",search_text:"Search...",search_results:"%1 results found.",no_entries_message:"No results found.",dateFilter_range:"Date range"},daterangepicker:{opens:"left",autoUpdateInput:!1,locale:{format:"DD/MM/YYYY",cancelLabel:"Clear"},ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},format:{dateISO:"DD/MM/YYYY"},filter:[]};b=a.extend(e,b);var f=this,g=null,h=null,i=null,j=null,l=null,m=b.id;if(m){var n="table#"+m+" > thead > tr > th[data-sort-by]",o=b.table_class;return this.handleConnectorResponse=function(a,b,c){g=a,h=b,i=c,f.updatePager()},this.callConnector=function(e){c.sort_by=b.sort_by,c.sort_mode=b.sort_mode,c.per_page=b.per_page,c.current_page=b.current_page,c.search=b.searchWord,c.filter=b.filter,void 0!=d?(g=d.header_data,h=d.body_data,i=d.response_options,f.handleConnectorResponse(g,h,i,e),f.trigger("rewatajax.callConnector",[d,"static"]),e()):a.ajax({method:"GET",url:b.ajax_connector,data:c,dataType:"json"}).done(function(a){if(a.status){var b=rewatajaxParseBodyData(a.body_data,a.header);f.handleConnectorResponse(a.header,b,a.options,e),e()}f.trigger("rewatajax.callConnector",[a,"ajax"])})},this.searchKeyUp=function(a){var c=this;clearTimeout(l),l=setTimeout(function(){c.search(a)},b.search_timeout)},this.search=function(a){b.current_page=1,b.searchWord=a,f.callConnector(function(){f.updateContent("search")})},this.createSearch=function(c){var d=document.createElement("div");d.className="table_search";var e=document.createElement("div");e.className="pull-left",e.className="col-md-4 text-right pull-right";var g=document.createElement("span");g.className="rewatajax_resultcounter",e.append(g),d.append(e);var h=document.createElement("div");h.className="pull-left col-md-8 row";var i=document.createElement("input");i.type="text",i.className="rewatajax_search_input form-control col-md-4",i.placeholder=b.language.search_text;var j=this;a(i).keyup(function(){j.searchKeyUp(a(this).val())}),h.append(i),d.append(h),f.trigger("rewatajax.createSearch",[h]),c.prepend(d)},this.getFilterForm=function(a){var c=g[a].type,d="";switch(c){case"date":d+="<label for='"+a+"-dateFilter-range'>"+b.language.dateFilter_range+"</label>",d+="<input type='text' class='input-sm form-control daterange' value='' onkeydown='return false' data-key='"+a+"' id='"+a+"-dateFilter-range' />"}return d},this.filterActive=function(a){for(var c in b.filter)for(var d in b.filter[c].filterOptions)if(b.filter[c].filterOptions[d].filterKey==a)return!0;return!1},this.hasFilter=function(c){return a(b.filter).each(function(a,b){if(b.filterType===c)return!0}),!1},this.format=function(a,b){return a.replace(/%(\d+)/g,function(a,c){return b[--c]})},this.gotoPage=function(a){b.current_page=a,this.updatePager(),f.callConnector(function(){f.updateContent("paginator")})},this.updatePager=function(){a(this).find("span.rewatajax_resultcounter").text(this.format(b.language.search_results,[i.total_results]));var c=this,d=a(this).find("nav.pagination_container");if(d.empty(),i.total_pages>1){var e=document.createElement("ul");if(e.className="pagination",b.current_page>=b.pager_max_buttons){var f=document.createElement("li");f.className="page-item",k=document.createElement("a"),k.className="page-link",k.setAttribute("href","javascript:;"),k.innerText="1",f.appendChild(k),a(f).click(function(){c.gotoPage(1)}),e.appendChild(f),f=document.createElement("li"),f.className="page-item page-dots",f.innerHTML="...",e.appendChild(f)}var g=Math.floor(b.current_page-b.pager_max_buttons/2)-1,h=g+b.pager_max_buttons+2;h=h>i.total_pages?i.total_pages:h,g=g<0?0:g;for(var j=g;j<h;j++){f=document.createElement("li"),f.className="page-item",b.current_page==j+1&&(f.className="page-item active");var k=document.createElement("a");k.className="page-link",k.setAttribute("href","javascript:;"),k.innerText=j+1,f.appendChild(k),a(f).click(function(){c.gotoPage(a(this).find("a").text())}),e.appendChild(f)}i.total_results<=Math.floor(i.total_pages-b.pager_max_buttons/2)&&(f=document.createElement("li"),f.innerHTML="...",f.className="page_button page_dots",e.appendChild(f),f=document.createElement("li"),f.className="page-item",k=document.createElement("a"),k.className="page-link",k.setAttribute("href","javascript:;"),k.innerText=i.total_pages,f.appendChild(k),a(f).click(function(){c.gotoPage(i.total_pages)}),e.appendChild(f)),d.html(e)}},this.isElement=function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName},this.addValueToTd=function(a,b){if(this.isElement(b))a.appendChild(b);else{var c=b;b.constructor===Object&&(c=b.content,b.id&&(a.id=b.id),b.class&&(a.className=b.class)),a.innerHTML=c}},this.getHead=function(){var a=document.createElement("thead"),c=document.createElement("tr");for(var d in g){var e=g[d],h=document.createElement("th"),j=e;if(e.constructor===Object){j=e.content,e.id&&(h.id=e.id);var k="";if(e.class&&(k+=e.class),e.width&&(h.width=e.width),e.sortable&&(h.dataset.sortBy=d,h.dataset.sortMode="",i.sortedBy==d)){var l="up";h.dataset.sortMode="desc","desc"==i.sortMode&&(l="down",h.dataset.sortMode="asc")}k&&(h.className=k.trim())}var m="<label>"+j+"</label>";if(e.filterable){h.dataset.filterable="";var n="rewatajax-filter";f.filterActive(d)&&(n+=" active"),m+='<a class="'+n+'" id="filter-'+d+'" tabindex="0" role="button" data-html="true" data-toggle="popover" data-placement="top" data-trigger="click" title="'+b.language.filter+" <button class='close'>&times;</button>\" data-content=\""+f.getFilterForm(d)+'"><i class="fa fa-filter"></i></a>'}h.innerHTML=m,c.appendChild(h)}return a.appendChild(c),a},this.getBody=function(){var c=document.createElement("tbody");if(0===h.length){var d=document.createElement("tr"),e=document.createElement("td");return e.colSpan=Object.keys(g).length,e.className="no-results",e.innerText=b.language.no_entries_message,d.appendChild(e),c.appendChild(d),c}return a(h).each(function(b,d){var e=document.createElement("tr");e.className="rewatajax-row",a(d).each(function(a,b){var c=document.createElement("td");c.className="rewatajax-column",b.key&&c.setAttribute("data-type",b.key);var d=b.content;if(null==d)e.appendChild(c);else{if(f.isElement(d))c.appendChild(d);else{var g=d;d.constructor===Object&&(g=d.content.content,d.id&&(c.id=d.id),d.class&&(c.className=d.class)),c.innerHTML=g}f.addValueToTd(c,b.content,b.key),e.appendChild(c)}}),c.appendChild(e)}),c},this.updateHead=function(c){var d=f.getHead().children;f.find("table#"+m+" > thead").html(d),a('[data-toggle="popover"]').popover({html:!0}).on("shown.bs.popover",function(c){var d="#"+a(c.target).attr("aria-describedby");a(d).find(".close").click(function(){a('[data-toggle="popover"]').popover("hide")});var e=a("input.daterange");e.data("daterangepicker")&&e.data("daterangepicker").remove(),e.daterangepicker(b.daterangepicker).on("apply.daterangepicker",function(c,d){var e=d.startDate.format(b.daterangepicker.locale.format),g=d.endDate.format(b.daterangepicker.locale.format),h=e+d.locale.separator+g;e==g&&(h=e),a(this).val(h);var i={filterKey:a(c.target).data("key"),filterValues:[d.startDate.format("YYYY-MM-DD"),d.endDate.format("YYYY-MM-DD")]};f.hasFilter("datetime")?b.filter[k].filterOptions.push(i):b.filter.push({filterType:"datetime",filterOptions:[i]}),a("a#filter-"+a(this).data("key")).addClass("active"),f.callConnector(function(){f.updateContent("datepicker")})}).on("cancel.daterangepicker",function(c,d){console.log("cancel triggered"),a(this).val(""),a(b.filter).each(function(a,c){"datetime"===c.filterType&&b.filter.splice(a,1)}),a("a#filter-"+a(this).data("key")).removeClass("active"),f.callConnector(function(){f.updateContent("datepicker")})})}),f.trigger("rewatajax.updateHead",[c])},this.updateContent=function(a){var b=f.getBody().children;f.find("table#"+m+" > tbody").html(b),f.trigger("rewatajax.updateContent",[a])},this.drawTable=function(){if(!g)return void console.log("Header data missing.");if(!h)return void console.log("Content data missing.");var a=document.createElement("table");a.id=m,a.className=o,j=f.getHead(),a.appendChild(j);var b=f.getBody();a.appendChild(b),f.html(a),f.trigger("rewatajax.drawTable",[type])},this.init=function(){var c=a(this);f.cleanup(c),c.innerHTML="";var d=document.createElement("table");d.id=m,d.className="rewatajax-table "+o;var e=document.createElement("thead");e.id=m+"_thead",d.appendChild(e);var g=document.createElement("tbody");g.id=m+"_tbody",d.appendChild(g);var h=document.createElement("div");h.className="ajax_loading",d.insertBefore(h,d.firstChild),c.html(d),b.search&&f.createSearch(c);var j=document.createElement("nav");j.setAttribute("aria-label","Page navigation"),j.className="pagination_container",c.append(j),f.callConnector(function(){f.updateHead("paginator"),f.updateContent("paginator")}),c.find("div.ajax_loading").hide(),c.on("click",n+" > label",function(){var c=a(this).parent("th"),d="asc";"asc"==a(c).attr("data-sort-mode")&&(d="desc"),a(n).attr("data-sort-mode",""),a(c).attr("data-sort-mode",d),b.sort_by=a(c).attr("data-sort-by"),b.sort_mode=d,f.callConnector(function(){f.updateContent("sort")})}),a(document).keydown(function(a){var c=a.target.tagName.toLowerCase();"input"!=c&&"select"!=c&&(37==a.which?b.current_page>1&&f.gotoPage(Number(b.current_page)-1):39==a.which&&b.current_page<i.total_pages&&f.gotoPage(Number(b.current_page)+1))}),f.trigger("rewatajax.init",[])},this.cleanup=function(b){a(document).unbind("keydown"),b&&b.unbind("click")},this}}})}(jQuery);